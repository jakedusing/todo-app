<%- include("partials/header") %>
<main>
  <h1>Welcome to your Dashboard <%= username %></h1>
  <h2>Incomplete Todos</h2>
  <ul>
    <% if (incompleteTodos && incompleteTodos.length > 0) { %> <%
    incompleteTodos.forEach((todo) => { %>
    <li>
      <%= todo.title %> - Due: <%= todo.dueDate ?
      todo.dueDate.toLocaleDateString() : "No due date" %> - Priority: <%=
      todo.priority %>
      <form
        action="/todos/toggle/<%= todo._id %>"
        method="POST"
        style="display: inline"
      >
        <button type="submit">Mark as Complete</button>
      </form>
      <form
        action="/todos/delete/<%= todo._id %>"
        method="POST"
        style="display: inline"
      >
        <button type="submit">Delete</button>
      </form>
    </li>
    <% }); %> <% } else { %>
    <p>No incomplete todos!</p>
    <% } %>
  </ul>

  <h2>Completed Todos</h2>
  <ul>
    <% if (completedTodos && completedTodos.length > 0) { %> <%
    completedTodos.forEach((todo) => { %>
    <li>
      <s><%= todo.title %></s>
      <form
        action="/todos/toggle/<%= todo._id %>"
        method="POST"
        style="display: inline"
      >
        <button type="submit">Mark as Incomplete</button>
      </form>
      <form
        action="/todos/delete/<%= todo._id %>"
        method="POST"
        style="display: inline"
      >
        <button type="submit">Delete</button>
      </form>
    </li>
    <% }); %> <% } else { %>
    <p>No completed todos!</p>
    <% } %>
  </ul>

  <!-- Form to Add a New Todo -->
  <h3>Add a New Todo</h3>
  <form action="/todos/add" method="POST">
    <input type="text" name="title" placeholder="Enter todo" required />
    <input type="date" name="dueDate" />
    <select name="priority">
      <option value="Low">Low</option>
      <option value="Medium">Medium</option>
      <option value="High">High</option>
    </select>
    <button type="submit">Add</button>
  </form>

  <a href="/auth/logout">Logout</a>
</main>
<%- include("partials/footer"); %>
