<%- include("partials/header"); %>
<link rel="stylesheet" href="/css/friendslist.css" />
<main
  class="container my-5 d-flex flex-column align-items-center justify-content-center"
>
  <!-- Flash Messages-->
  <% if (success_msg.length > 0) {%>
  <div class="alert alert-success alert-dismissible fade show" role="alert">
    <%= success_msg %>
    <button
      type="button"
      class="btn-close"
      data-bs-dismiss="alert"
      aria-label="Close"
    ></button>
  </div>
  <% } %> <% if (error_msg.length > 0) {%>
  <div class="alert alert-danger alert-dismissible fade show" role="alert">
    <%= error_msg %>
    <button
      type="button"
      class="btn-close"
      data-bs-dismiss="alert"
      aria-label="Close"
    ></button>
  </div>
  <% } %>

  <!-- Header -->
  <h1 class="mb-4 text-center">My Friends</h1>

  <!-- Pending Requests Received -->
  <section class="mb-5 w-75">
    <h2 class="h4 text-primary mb-3 text-center">Pending Friend Requests</h2>
    <% if (pendingRequests && pendingRequests.length > 0) {%>
    <ul class="list-group d-flex align-items-center">
      <% pendingRequests.forEach(request => {%>
      <li
        class="list-group-item request-item d-flex justify-content-between align-items-center"
      >
        <span class="fw-bold"><%= request.requester.username %></span>
        <form
          action="/friends/accept/<%= request._id %>"
          method="POST"
          class="d-inline"
        >
          <button class="btn btn-success btn-sm">Accept</button>
        </form>
      </li>
      <% }); %>
    </ul>
    <% } else { %>
    <p class="text-muted text-center">No pending requests received.</p>
    <% } %>
  </section>

  <!-- Pending Requests Sent -->
  <section class="mb-5 w-75">
    <h2 class="h4 text-primary mb-3 text-center">Pending Requests Sent</h2>
    <% if (sentRequests && sentRequests.length > 0) {%>
    <ul class="list-group d-flex align-items-center">
      <% sentRequests.forEach(request => {%>
      <li class="list-group-item text-center">
        Request sent to
        <span class="fw-bold"><%= request.recipient.username %></span>
      </li>
      <% }); %>
    </ul>
    <% } else { %>
    <p class="text-muted text-center">No pending requests sent.</p>
    <% } %>
  </section>

  <!-- Accepted Friends -->
  <section class="w-75">
    <h2 class="h4 text-primary mb-3 text-center">Friends</h2>
    <% if (friends && friends.length > 0) {%>
    <ul class="list-group d-flex align-items-center">
      <% friends.forEach(friend => {%>
      <li class="list-group-item friend-item d-flex align-items-center">
        <i class="bi bi-person-circle me-2 text-primary"></i>
        <span><%= friend.username %></span>
      </li>
      <% }); %> <% }else { %>
      <p class="text-muted text-center">No friends yet.</p>
      <% } %>
    </ul>
  </section>
</main>
<%- include("partials/footer"); %>
